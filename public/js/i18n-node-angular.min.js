!function(){"use strict";var e=angular.module("i18n",[]);e.provider("i18n",function(){var e=this;e.objectNotation=".",e.setObjectNotation=function(n){e.objectNotation=n},e.$get=["$rootScope","$http","$q",function(n,t,r){var i=function(){this._localeLoadedDeferred=r.defer(),this._deferredStack=[],this.loaded=!1,this.init=function(e){if(e!=this.userLanguage){this._localeLoadedDeferred&&this._deferredStack.push(this._localeLoadedDeferred),this._localeLoadedDeferred=r.defer(),this.loaded=!1,this.userLanguage=e;var i=this;t({method:"get",url:"/i18n/"+e,cache:!0}).success(function(e){for(n.i18n=e,i.loaded=!0,i._localeLoadedDeferred.resolve(n.i18n);i._deferredStack.length;)i._deferredStack.pop().resolve(n.i18n);n.$broadcast("LOCALE_UPDATED")}).error(function(e){for(i._localeLoadedDeferred.reject(e);i._deferredStack.length;)i._deferredStack.pop().reject(e)})}return this._localeLoadedDeferred.promise},this.i18n=function(){var e=r.defer(),n=this;return this.ensureLocaleIsLoaded().then(function(){e.resolve(n)}),e.promise},this.ensureLocaleIsLoaded=function(){return this._localeLoadedDeferred.promise},this.getTranslationObject=function(t){var r=t.split(e.objectNotation).reduce(function(e,n){return e&&e.hasOwnProperty(n)?e[n]:null},n.i18n);return r},this.__=function(e){if(!n.i18n)return e;var r=n.i18n[e]||this.getTranslationObject(e);return r||(r=e,n.i18n[e]=r,t.get("/i18n/"+this.userLanguage+"/"+encodeURIComponent(e)).success(function(t){n.i18n[e]=t})),arguments.length>1&&"function"==typeof vsprintf&&(r=vsprintf(r,Array.prototype.slice.call(arguments,1))),r},this.__n=function(e,r,i){if(!n.i18n)return r;var o=n.i18n[r]||this.getTranslationObject(r);if(!o){i||(i=r),o={one:r,other:i},n.i18n[r]=o;var c="/i18n/"+this.userLanguage+"/"+encodeURIComponent(r)+"?plural="+encodeURIComponent(i)+"&count="+encodeURIComponent(e);t.get(c).success(function(e){n.i18n[r]=e})}return o=1==e?o.one:o.other,"function"==typeof vsprintf&&(o=vsprintf(o,[e])),o}};return new i}]}),e.directive("i18n",["i18n","$rootScope",function(e,n){return{restrict:"A",link:function(t,r,i){function o(n,t){n=n||i.i18n,t=t||c(),r.text(void 0===t?e.__(n):e.__n(t,n))}function c(){var e=i.count;return e&&parseInt(e)}i.$observe("i18n",function(e){o(e)}),n.$on("LOCALE_UPDATED",function(){o()})}}}]),e.directive("i18nLocale",["i18n","$rootScope",function(e,n){return{restrict:"A",link:function(t,r,i){i.$observe("i18nLocale",function(n){e.init(n)}),n.$watch("i18nLocale",function(n,t){n&&n!=t&&e.init(n)})}}}]),e.filter("i18n",["i18n",function(e){function n(e){return!isNaN(parseFloat(e))&&isFinite(e)}var t=function(t){return n(t)?e.__n.apply(e,arguments):e.__.apply(e,arguments)};return t.$stateful=!0,t}])}();